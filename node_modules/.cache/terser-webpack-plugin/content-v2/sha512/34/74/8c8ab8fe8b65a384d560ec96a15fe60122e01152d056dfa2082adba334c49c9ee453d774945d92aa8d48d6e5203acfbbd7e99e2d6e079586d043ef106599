{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{618:function(t,s,a){\"use strict\";a.r(s);var e=a(6),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"华为云项目部署\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#华为云项目部署\"}},[t._v(\"#\")]),t._v(\" 华为云项目部署\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"搭建仓库\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#搭建仓库\"}},[t._v(\"#\")]),t._v(\" 搭建仓库\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud1.png\",alt:\"image-20200810141620919\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"设置ssh密匙\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#设置ssh密匙\"}},[t._v(\"#\")]),t._v(\" 设置SSH密匙\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud2.png\",alt:\"image-20200810142554264\"}})]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud3.png\",alt:\"image-20200810142539265\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"push项目\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#push项目\"}},[t._v(\"#\")]),t._v(\" push项目\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud4.png\",alt:\"image-20200810142632404\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"代码检查\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#代码检查\"}},[t._v(\"#\")]),t._v(\" 代码检查\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud5.png\",alt:\"image-20200810143555408\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"显示菜单\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#显示菜单\"}},[t._v(\"#\")]),t._v(\" 显示菜单\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud6.png\",alt:\"image-20200810144143393\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"构建编译\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#构建编译\"}},[t._v(\"#\")]),t._v(\" 构建编译\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud7.png\",alt:\"image-20200810144611137\"}})]),t._v(\" \"),a(\"p\",[t._v(\"不使用模板，选择“制作镜像并推送SWR仓库”构建，构建完将自动上传至镜像仓库\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud17.png\",alt:\"image-20200811172316163\"}})]),t._v(\" \"),a(\"p\",[t._v(\"此构建需要的Dockerfile文件内容如下：\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-dockerfile line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-dockerfile\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 基于的基础镜像\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"FROM\")]),t._v(\" python\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"3.6.8\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 维护者信息\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"MAINTAINER\")]),t._v(\" WangScaler@163.com\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 代码添加到code文件夹\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"ADD\")]),t._v(\" / /ziot\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 设置code文件夹是工作目录\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"WORKDIR\")]),t._v(\" /ziot\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 安装支持\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" cd /ziot && ls\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" ls\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" pip install \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"user \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"r /ziot/requirements.txt \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"i  https\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"//pypi.doubanio.com/simple/\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" python CreateLicense.py 02\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"42\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"ac\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"12\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"00\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"02\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" python setup.py\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" python \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"m compileall \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"b build/\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"RUN\")]),t._v(\" pwd && ls\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"CMD\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"python\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"build/server.pyc\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"\\n\")])]),t._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"24\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"部署\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#部署\"}},[t._v(\"#\")]),t._v(\" 部署\")]),t._v(\" \"),a(\"p\",[t._v(\"在部署的机器上配置密码登录\")]),t._v(\" \"),a(\"h4\",{attrs:{id:\"获取长期有效docker-login指令\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#获取长期有效docker-login指令\"}},[t._v(\"#\")]),t._v(\" 获取长期有效docker login指令\")]),t._v(\" \"),a(\"h4\",{attrs:{id:\"操作步骤\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#操作步骤\"}},[t._v(\"#\")]),t._v(\" 操作步骤\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"获取镜像仓库访问地址、区域项目名称。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"登录管理控制台，单击右上角您的用户名处，单击“我的凭证”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在“API凭证”的项目列表中查找当前区域对应的项目。\")]),t._v(\" \"),a(\"p\",[t._v(\"如下图所示，“华北-北京一”对应的项目为“cn-north-1”。\")]),t._v(\" \"),a(\"p\",[t._v(\"​       \"),a(\"strong\",[t._v(\"图1\")]),t._v(\" 区域与项目         \"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/usermanual-swr/zh-cn_image_0235931896.png\",alt:\"点击放大\"}})]),t._v(\" \"),a(\"p\",[t._v(\"镜像仓库地址为 : swr.区域项目名称.myhuaweicloud.com，如中国华北区1对应的镜像仓库地址为：swr.cn-north-1.myhuaweicloud.com。\")])])])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"获取AK/SK访问密钥。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://res-img3.huaweicloud.com/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg\",alt:\"img\"}}),t._v(\"说明：\")]),t._v(\" \"),a(\"p\",[t._v(\"访问密钥即AK/SK（Access Key ID/Secret Access Key），表示一组密钥对，用于验证调用API发起请求的访问者身份，与密码的功能相似。如果您已有AK/SK，可以直接使用，无需再次获取。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"登录管理控制台，单击右上角您的用户名处，单击“我的凭证”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在左侧导航栏中选择“访问密钥”，单击“新增访问密钥”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"输入当前用户的登录密码，并通过邮箱或者手机进行验证。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://res-img3.huaweicloud.com/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg\",alt:\"img\"}}),t._v(\"说明：\")]),t._v(\" \"),a(\"p\",[t._v(\"在统一身份认证服务中创建的用户，如果创建时未填写邮箱或者手机号，则只需校验登录密码。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击“确定”，下载访问密钥，其中包含AK和SK。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://res-img3.huaweicloud.com/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg\",alt:\"img\"}}),t._v(\"说明：\")]),t._v(\" \"),a(\"p\",[t._v(\"为防止访问密钥泄露，建议您将其保存到安全的位置。\")])])])]),t._v(\" \"),a(\"li\")]),t._v(\" \"),a(\"p\",[t._v(\"登录一台linux系统的计算机，执行如下命令获取登录密钥。\")]),t._v(\" \"),a(\"p\",[a(\"strong\",[t._v(\"printf \\\"*$AK*\\\" | openssl dgst -binary -sha256 -hmac \\\"*$SK*\\\" | od -An -vtx1 | sed 's/[ \\\\n]//g' | sed 'N;s/\\\\n//'\")])]),t._v(\" \"),a(\"p\",[t._v(\"其中$AK和$SK为\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/usermanual-swr/swr_01_1000.html#swr_01_1000__li1863783911295\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"2\"),a(\"OutboundLink\")],1),t._v(\"获取的AK/SK。\")]),t._v(\" \"),a(\"p\",[t._v(\"​     \"),a(\"strong\",[t._v(\"图2\")]),t._v(\" 示例\"),a(\"br\"),t._v(\"\\n​     \"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/usermanual-swr/zh-cn_image_0165729699.png\",alt:\"点击放大\"}})]),t._v(\" \"),a(\"ol\",{attrs:{start:\"4\"}},[a(\"li\",[a(\"p\",[t._v(\"使用如下的格式拼接docker login指令。\")]),t._v(\" \"),a(\"p\",[a(\"strong\",[t._v(\"docker login -u\")]),t._v(\" [\"),a(\"em\",[t._v(\"区域项目名\")]),t._v(\"]\"),a(\"strong\",[t._v(\"@\")]),t._v(\"[\"),a(\"em\",[t._v(\"AK\")]),t._v(\"] \"),a(\"strong\",[t._v(\"-p\")]),t._v(\" [\"),a(\"em\",[t._v(\"登录密钥\")]),t._v(\"] [\"),a(\"em\",[t._v(\"镜像仓库地址\")]),t._v(\"]\")]),t._v(\" \"),a(\"p\",[t._v(\"其中，区域项目名和镜像仓库地址在\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/usermanual-swr/swr_01_1000.html#swr_01_1000__li5768123671815\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"1\"),a(\"OutboundLink\")],1),t._v(\"中获取，AK在\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/usermanual-swr/swr_01_1000.html#swr_01_1000__li1863783911295\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"2\"),a(\"OutboundLink\")],1),t._v(\"中获取，登录密钥为\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/usermanual-swr/swr_01_1000.html#swr_01_1000__li132430753010\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"3\"),a(\"OutboundLink\")],1),t._v(\"的执行结果。\")])])]),t._v(\" \"),a(\"p\",[t._v(\"总结：\")]),t._v(\" \"),a(\"p\",[t._v(\"根据ak和sk在centos上生成登录密匙\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"printf \\\"NO2PHUZE1YZIJLPFSPCX\\\" | openssl dgst -binary -sha256 -hmac \\\"IJKQNzFVZuW2o8xr417lL3qMAqSlFNZFt7LjhtA3\\\" | od -An -vtx1 | sed 's/[ \\\\n]//g' | sed 'N;s/\\\\n//'\\n\\n\")])]),t._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),a(\"br\")])]),a(\"p\",[t._v(\"登录\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"docker login -u cn-north-4@NO2PHUZE1YZIJLPFSPCX -p 15489d25d17a228b24727c45ebb17262ba0e3702eccaadbeb69415b914a48eb7 swr.cn-north-4.myhuaweicloud.com\\n\\n\")])]),t._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),a(\"br\")])]),a(\"p\",[t._v(\"拉取镜像\")]),t._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"docker pull swr.cn-north-4.myhuaweicloud.com/ziot/ziot:v1.1\\n\")])]),t._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),a(\"br\")])]),a(\"h4\",{attrs:{id:\"部署镜像\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#部署镜像\"}},[t._v(\"#\")]),t._v(\" 部署镜像\")]),t._v(\" \"),a(\"p\",[t._v(\"停止部署机器上已存在的容器\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud12.png\",alt:\"image-20200811170059114\"}})]),t._v(\" \"),a(\"p\",[t._v(\"删除部署机器上已存在的容器\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud13.png\",alt:\"image-20200811170113421\"}})]),t._v(\" \"),a(\"p\",[t._v(\"删除部署机器上已存在的镜像\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud14.png\",alt:\"image-20200811170124937\"}})]),t._v(\" \"),a(\"p\",[t._v(\"登录镜像仓库\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud8.png\",alt:\"image-20200811132614520\"}})]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud9.png\",alt:\"image-20200811132627778\"}})]),t._v(\" \"),a(\"p\",[t._v(\"拉取镜像\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud15.png\",alt:\"image-20200811170150403\"}})]),t._v(\" \"),a(\"p\",[t._v(\"运行镜像\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud16.png\",alt:\"image-20200811170205173\"}})]),t._v(\" \"),a(\"h2\",{attrs:{id:\"构建持续交付流水线\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#构建持续交付流水线\"}},[t._v(\"#\")]),t._v(\" \"),a(\"strong\",[t._v(\"构建持续交付流水线\")])]),t._v(\" \"),a(\"p\",[t._v(\"实现自动化检查代码，构建项目镜像，发布到仓库，在部署机器上拉取镜像，运行项目镜像\")]),t._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[a(\"strong\",[t._v(\"预置流水线任务\")])]),t._v(\" \"),a(\"th\",[a(\"strong\",[t._v(\"任务说明\")])])])]),t._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[t._v(\"代码检查\")]),t._v(\" \"),a(\"td\",[t._v(\"基本的流水线任务。\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"Dockefile\")]),t._v(\" \"),a(\"td\",[t._v(\"构建成docker镜像流水线任务。\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"部署镜像\")]),t._v(\" \"),a(\"td\",[t._v(\"部署到生产机器流水线任务。\")])])])]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://res-img3.huaweicloud.com/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg\",alt:\"img\"}}),t._v(\"说明：\")]),t._v(\" \"),a(\"p\",[t._v(\"关于vote、result、worker的说明，请参见\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/bestpractice-devcloud/devcloud_practice_2009.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"HE2E DevOps实践流程\"),a(\"OutboundLink\")],1),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"为了更好的介绍流水线服务的操作流程，本章节将创建全新的流水线。\")]),t._v(\" \"),a(\"h4\",{attrs:{id:\"配置流水线串接代码检查-编译构建和自动化部署步骤\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置流水线串接代码检查-编译构建和自动化部署步骤\"}},[t._v(\"#\")]),t._v(\" \"),a(\"strong\",[t._v(\"配置流水线串接代码检查，编译构建和自动化部署步骤\")])]),t._v(\" \"),a(\"p\",[t._v(\"通过本节，您将学习如何创建\"),a(\"strong\",[t._v(\"流水线\")]),t._v(\"任务，完成应用程序持续交付流水线的搭建。\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[a(\"strong\",[t._v(\"创建并触发持续交付流水线\")])])]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"进入项目，单击页面上方导航\")]),t._v(\" \"),a(\"p\",[t._v(\"“构建&发布 > 流水线”\")]),t._v(\" \"),a(\"p\",[t._v(\"，进入流水线服务。\")]),t._v(\" \"),a(\"p\",[t._v(\"​    单击    “新建流水线”，根据下表配置流水线。\")]),t._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[a(\"strong\",[t._v(\"步骤\")])]),t._v(\" \"),a(\"th\",[a(\"strong\",[t._v(\"填写/选择建议\")])])])]),t._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[t._v(\"基本信息\")]),t._v(\" \"),a(\"td\",[t._v(\"流水线名称：代码检查\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"选择模板\")]),t._v(\" \"),a(\"td\",[t._v(\"不使用模板，直接创建\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"选择代码源\")]),t._v(\" \"),a(\"td\",[t._v(\"DevCloud 源码仓库：ziot\")])])])])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击图标\"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232355691.png\",alt:\"img\"}}),t._v(\"删除阶段“发布仓库”，单击图标\"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232353852.png\",alt:\"img\"}}),t._v(\"添加“自定义阶段”。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232673601.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击图标\"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0231814761.png\",alt:\"img\"}}),t._v(\"，在右侧滑出框中输入名称“代码检查”，单击“保存”。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232353965.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击阶段“代码检查”中“请选择子任务”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在右侧滑出框中，类型选择“代码检查”，任务勾选“ziot_1”，单击“保存”。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud10.png\",alt:\"image-20200811163037823\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"按照同样方式，添加构建任务“构建镜像”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在阶段“编译构建”\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"imag/hwcloud11.png\",alt:\"image-20200811150544149\"}})]),t._v(\" \"),a(\"p\",[t._v(\"构建成docker镜像，并发布到镜像仓库。\")]),t._v(\" \"),a(\"p\",[t._v(\"8.构建编译阶段后后添加阶段“部署”，并在该阶段中添加部署任务“部署镜像”，单击“保存”。\")]),t._v(\" \"),a(\"p\",[t._v(\"系统自动跳转至“流水线详情”页面，单击“全新执行”，启动流水线。\")]),t._v(\" \"),a(\"p\",[t._v(\"当出现以下页面时，表示任务执行成功。若任务执行失败，请于执行失败处检查失败原因（如：部署阶段执行失败，则进入部署任务查看部署日志，结合\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/bestpractice-devcloud/devcloud_practice_2007.html#devcloud_practice_2007__li145881144518\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"6\"),a(\"OutboundLink\")],1),t._v(\"排查失败原因），或参照\"),a(\"a\",{attrs:{href:\"https://support.huaweicloud.com/cloudpipeline/index.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"流水线-帮助文档\"),a(\"OutboundLink\")],1),t._v(\"中的常见问题排查。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232434775.png\",alt:\"点击放大\"}})])])]),t._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[t._v(\"添加质量门禁\")]),t._v(\" \"),a(\"p\",[t._v(\"为了控制代码的质量，代码必须经过扫描，并且错误数量控制在合理范围内，才允许发布。通过添加质量门禁可以有效的自动化控制流程。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"进入流水线任务“phoenix-sample-pipeline”的“流水线配置”页面。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在阶段“代码检查”下的“质量门禁处”，单击\"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232675486.png\",alt:\"img\"}}),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"在页面右侧滑框中，单击“点击创建”。\")]),t._v(\" \"),a(\"p\",[t._v(\"在弹框中输入名称“代码检查门禁”， 打开“CodeCheck问题数”开关并输入门禁阈值“5”，单击“保存”。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232675487.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在“门禁”下拉列表中选择刚刚创建的“代码检查门禁”，单击“保存”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"保存流水线，返回\")]),t._v(\" \"),a(\"p\",[t._v(\"“流水线详情”\")]),t._v(\" \"),a(\"p\",[t._v(\"页面。\")]),t._v(\" \"),a(\"p\",[t._v(\"启动流水线任务，待任务执行结束可看到：由于代码检查问题数大于5，因此流水线任务执行失败。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232675488.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击\")]),t._v(\" \"),a(\"p\",[t._v(\"“配置”\")]),t._v(\" \"),a(\"p\",[t._v(\"，修改\")]),t._v(\" \"),a(\"p\",[t._v(\"“代码检查门禁”\")]),t._v(\" \"),a(\"p\",[t._v(\"的阈值为15，保存流水线并执行。\")]),t._v(\" \"),a(\"p\",[t._v(\"待任务执行结束可看到：由于代码检查问题数小于15，因此流水线任务执行成功。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232678518.png\",alt:\"点击放大\"}})])])])])]),t._v(\" \"),a(\"h4\",{attrs:{id:\"更新流水线配置-实现代码变更触发的持续交付流水线\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#更新流水线配置-实现代码变更触发的持续交付流水线\"}},[t._v(\"#\")]),t._v(\" \"),a(\"strong\",[t._v(\"更新流水线配置，实现代码变更触发的持续交付流水线\")])]),t._v(\" \"),a(\"p\",[t._v(\"通过本节，您将学习如何创建实现代码变更自动触发持续交付流水线任务，完成应用的自动化构建部署。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"进入项目，单击页面上方导航“构建&发布 > 流水线”，进入流水线服务。\")]),t._v(\" \"),a(\"p\",[t._v(\"找到流水线任务“phoenix-sample-pipeline”，单击此任务对应操作列中的图标\"),a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0231814761.png\",alt:\"img\"}}),t._v(\"，进入“流水线配置”页面。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"选择“触发器”页签，在“触发分支”下拉列表中勾选所需分支，单击“保存”。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232678550.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"设置完成后，当所选分支有代码变更提交时，将自动触发该任务。\")])])]),t._v(\" \"),a(\"h4\",{attrs:{id:\"流水线配置高级功能\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#流水线配置高级功能\"}},[t._v(\"#\")]),t._v(\" \"),a(\"strong\",[t._v(\"流水线配置高级功能\")])]),t._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[t._v(\"查看健康度\")]),t._v(\" \"),a(\"p\",[t._v(\"​     通过健康度可以统计流水线调度的不同任务的执行健康程度以及执行的结果统计。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"进入流水线服务，单击任务“phoenix-sample-pipeline”进入“流水线详情”页面。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"单击页面右上角健康度，进入\")]),t._v(\" \"),a(\"p\",[t._v(\"“流水线健康度”\")]),t._v(\" \"),a(\"p\",[t._v(\"页面，即可查看各任务的健康度。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232678561.png\",alt:\"点击放大\"}})])])])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"添加人工审核\")]),t._v(\" \"),a(\"p\",[t._v(\"​     DevCloud支持在流水线任务中加入人工审核设置，在某个阶段任务执行完成时，需要人工审核通过才能继续执行。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"进入流水线任务“phoenix-sample-pipeline”的“流水线配置”页面。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"在阶段\")]),t._v(\" \"),a(\"p\",[t._v(\"“部署”\")]),t._v(\" \"),a(\"p\",[t._v(\"下，单击\")]),t._v(\" \"),a(\"p\",[t._v(\"“添加任务”\")]),t._v(\" \"),a(\"p\",[t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"在右侧滑框中，选择类型“流水线控制”，勾选“人工审核”，并在“审核人”下拉列表中勾选所需的审核人。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232678567.png\",alt:\"点击放大\"}})]),t._v(\" \"),a(\"p\",[t._v(\"页面中的说明如下：\")]),t._v(\" \"),a(\"table\",[a(\"thead\",[a(\"tr\",[a(\"th\",[a(\"strong\",[t._v(\"参数\")])]),t._v(\" \"),a(\"th\",{staticStyle:{\"text-align\":\"left\"}},[a(\"strong\",[t._v(\"说明\")])])])]),t._v(\" \"),a(\"tbody\",[a(\"tr\",[a(\"td\",[t._v(\"审核人\")]),t._v(\" \"),a(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"可以设置一个或多个审核人。\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"审核模式\")]),t._v(\" \"),a(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"全部人审核表示所有人都必须通过任何才能继续，任一人审核表示审核人列表中的任何一个人审核任务就可以继续。\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"审核时长\")]),t._v(\" \"),a(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"设置审核的有效期，超期后审核无效，不能在进行审核。\")])]),t._v(\" \"),a(\"tr\",[a(\"td\",[t._v(\"备注\")]),t._v(\" \"),a(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"审核说明。\")])])])])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"返回“流水线配置”页面，将任务“流水线控制”拖动到任务“部署”上方，单击“保存”。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"启动流水线，当执行到\")]),t._v(\" \"),a(\"p\",[t._v(\"“人工审核”\")]),t._v(\" \"),a(\"p\",[t._v(\"时，页面中将弹框提示任务需审核。\")]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"https://support.huaweicloud.com/bestpractice-devcloud/zh-cn_image_0232678597.png\",alt:\"点击放大\"}})])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"审核人进入流水线任务\")]),t._v(\" \"),a(\"p\",[t._v(\"“phoenix-sample-pipeline”\")]),t._v(\" \"),a(\"p\",[t._v(\"的详情页\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"单击“批准”，流水线将自动继续执行。\")]),t._v(\" \"),a(\"li\",[t._v(\"单击“驳回”，流水线将中止执行。\")])])])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}