{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{570:function(s,a,t){s.exports=t.p+\"assets/img/docker8.334b2345.png\"},571:function(s,a,t){s.exports=t.p+\"assets/img/docker9.09ccc104.png\"},640:function(s,a,t){\"use strict\";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[e(\"p\",[s._v(\"[TOC]\")]),s._v(\" \"),e(\"h1\",{attrs:{id:\"基于docker搭建redis一主两从三哨兵\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#基于docker搭建redis一主两从三哨兵\"}},[s._v(\"#\")]),s._v(\" 基于Docker搭建Redis一主两从三哨兵\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"获取redis镜像\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#获取redis镜像\"}},[s._v(\"#\")]),s._v(\" 获取Redis镜像\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"docker命令拉取镜像\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#docker命令拉取镜像\"}},[s._v(\"#\")]),s._v(\" docker命令拉取镜像\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"docker pull redis\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"查看镜像\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#查看镜像\"}},[s._v(\"#\")]),s._v(\" 查看镜像\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"docker image \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ls\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"获取并修改redis配置文件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#获取并修改redis配置文件\"}},[s._v(\"#\")]),s._v(\" 获取并修改redis配置文件\")]),s._v(\" \"),e(\"p\",[s._v(\"redis官方提供了一个配置文件样例，通过wget工具下载下来。\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" http://download.redis.io/redis-stable/redis.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"在此只做配置主从关系的必要修改\")]),s._v(\" \"),e(\"p\",[s._v(\"其中redis服务器的master和slave角色使用的配置文件还会有些不同，下面分别进行说明。\")]),s._v(\" \"),e(\"p\",[e(\"strong\",[s._v(\"首先说明一下\")]),s._v(\"，正常情况下配置主从关系需要多台机器，但现实往往不允许。所以现在在一台机器上模拟。\")]),s._v(\" \"),e(\"p\",[s._v(\"将下载下来的redis.conf复制三份，分别命名为\\nredis-master.conf,redis-slave1.conf,redis-slave2.conf\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" redis.conf redis-master.conf\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" redis.conf redis-slave1.conf\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" redis.conf redis-slave2.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\")])]),e(\"p\",[s._v(\"将三个配置文件我放在了/usr/local/docker-redis/目录下\")]),s._v(\" \"),e(\"p\",[s._v(\"首先修改master的配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" redis-master.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 注释这一行，表示Redis可以接受任意ip的连接\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# bind 127.0.0.1 \")]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 关闭保护模式\")]),s._v(\"\\nprotected-mode no \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 让redis服务后台运行\")]),s._v(\"\\ndaemonize \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\" \\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设定主库的密码，用于认证，如果主库开启了requirepass选项这里就必须填相应的密码\")]),s._v(\"\\nmasterauth \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"master-password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设定密码(可选，如果这里开启了密码要求，slave的配置里就要加这个密码. 只是练习配置，就不使用密码认证了)\")]),s._v(\"\\n requirepass masterpassword \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 配置日志路径，为了便于排查问题，指定redis的日志文件目录\")]),s._v(\"\\nlogfile \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/var/log/redis/redis.log\"')]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),e(\"br\")])]),e(\"p\",[s._v(\"如果是服务器，redis密码很重要，因为redis默认没密码有漏洞，有很多人利用redis漏洞来使你的服务器挖矿，亲身体会。\")]),s._v(\" \"),e(\"p\",[s._v(\"其次修改slave配置。\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" redis-slave1.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 注释这一行，表示Redis可以接受任意ip的连接\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# bind 127.0.0.1 \")]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 关闭保护模式\")]),s._v(\"\\nprotected-mode no \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 让redis服务后台运行\")]),s._v(\"\\ndaemonize \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\" \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设定密码(可选，如果这里开启了密码要求，slave的配置里就要加这个密码)\")]),s._v(\"\\nrequirepass masterpassword \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设定主库的密码，用于认证，如果主库开启了requirepass选项这里就必须填相应的密码\")]),s._v(\"\\nmasterauth \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"master-password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 设定master的IP和端口号，redis配置文件中的默认端口号是6379\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 低版本的redis这里会是slaveof，意思是一样的，因为slave是比较敏感的词汇，所以在redis后面的版本中不在使用slave的概念，取而代之的是replica\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 将35.236.172.131做为主，其余两台机器做从。ip和端口号按照机器和配置做相这里的IP地址往下看。\")]),s._v(\"\\nreplicaof \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"198.18\")]),s._v(\".0.2 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 配置日志路径，为了便于排查问题，指定redis的日志文件目录\")]),s._v(\"\\nlogfile \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/logs/redis.log\"')]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),e(\"br\")])]),e(\"p\",[s._v(\"上方提到的这个主节点地址为master的docker容器的地址，可以通过以下命令查看\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-bash line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[e(\"code\",[s._v(\"docker inspect redis_master  \"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 用来查看容器的详细信息\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"slave2配置与上述相同。\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"启动容器\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#启动容器\"}},[s._v(\"#\")]),s._v(\" 启动容器\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"首先以后台模式运行master容器,注意文件的地址\\ndocker run -it --name redis-master --network\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"dockercompose --ip \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"172.19\")]),s._v(\".0.2 -v /data/docker_redis/redis-conf/redis-master.conf:/usr/local/redis/redis.conf -d -p \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\":6379 redis /bin/bash\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\")])]),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"首先以后台模式运行slave1容器,注意文件的地址和端口号，物理机的端口号不可冲突\\n$ docker run -it --name redis-master -v /usr/local/docker-redis/redis-slave1.conf:/usr/local/redis/redis.conf -d -p \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6380\")]),s._v(\":6379 redis /bin/bash\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\")])]),e(\"p\",[s._v(\"slave2启动同上\")]),s._v(\" \"),e(\"p\",[s._v(\"接下来进入容器里启动redis服务器。\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"以交互模式进入容器redis-master\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#以交互模式进入容器redis-master\"}},[s._v(\"#\")]),s._v(\" 以交互模式进入容器redis-master\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"docker \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"exec\")]),s._v(\" -it redis-master \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"bash\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"创建日志文件目录-与配置文件相同\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#创建日志文件目录-与配置文件相同\"}},[s._v(\"#\")]),s._v(\" 创建日志文件目录,与配置文件相同\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /usr/local/logs/\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"touch\")]),s._v(\" /usr/local/logs/redis.log\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"启动redis服务器-如果没有任何输出-就说明成功了\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#启动redis服务器-如果没有任何输出-就说明成功了\"}},[s._v(\"#\")]),s._v(\" 启动redis服务器，如果没有任何输出，就说明成功了\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"redis-server /usr/local/redis/redis.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"在容器里启动一个redis客户端\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#在容器里启动一个redis客户端\"}},[s._v(\"#\")]),s._v(\" 在容器里启动一个redis客户端\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\" redis-cli\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"输入密码-进行身份验证\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#输入密码-进行身份验证\"}},[s._v(\"#\")]),s._v(\" 输入密码，进行身份验证\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" auth password\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"执行info命令-查看服务器状态\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#执行info命令-查看服务器状态\"}},[s._v(\"#\")]),s._v(\" 执行info命令，查看服务器状态\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" info\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"如果是主，这里的role的值会是master，如果是从，这里的role的值会是slave\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:t(570),alt:\"image-20200716160649926\"}})]),s._v(\" \"),e(\"p\",[s._v(\"对于slave，还要查看master_link_status这个属性值。slave上这个属性值为up就说明主从复制是OK的，否者就有问题。如果从机状态不为up，首先排查主机的端口是否被限，然后查看redis日志排查原因\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"退出客户端\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#退出客户端\"}},[s._v(\"#\")]),s._v(\" 退出客户端\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:637\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[e(\"span\",{pre:!0,attrs:{class:\"token file-descriptor important\"}},[s._v(\"9\")]),s._v(\">\")]),s._v(\" quit\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"最后退出容器\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#最后退出容器\"}},[s._v(\"#\")]),s._v(\" 最后退出容器\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"exit\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h2\",{attrs:{id:\"验证主从复制\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#验证主从复制\"}},[s._v(\"#\")]),s._v(\" 验证主从复制\")]),s._v(\" \"),e(\"p\",[s._v(\"主从搭建成功后，可以通过在master上写入一个key-value值，查看是否会同步到slave上，来验证主从同步是否能成功\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"redis-cli\\nauth password\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"test\")]),s._v(\" hello\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\")])]),e(\"p\",[s._v(\"在任意slave机器上进入容器，也运行一个redis-cli，查询这个key的值。如果能查询到这个值，且与主机上的值相同，说明主从同步成功。经测试，主动同步成功。\")]),s._v(\" \"),e(\"div\",{staticClass:\"language- line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"redis-cli\\nauth password\\nget test \\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\")])]),e(\"h2\",{attrs:{id:\"添加哨兵\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#添加哨兵\"}},[s._v(\"#\")]),s._v(\" 添加哨兵\")]),s._v(\" \"),e(\"p\",[s._v(\"可以在主发生故障后，自动进行故障转移，从从机里选出一台升级为主机，并持续监听着原来的主机，当原来的主机恢复后，会将其作为新主的从机。\")]),s._v(\" \"),e(\"p\",[s._v(\"哨兵先监听主，通过对主发送info命令，获取到从的信息，然后也会监听到从。另外哨兵都会像主订阅__sentinel__:hello频道，当有新的哨兵加入时，会向这个频道发送一条信息，这条信息包含了该哨兵的IP和端口等信息，那么其他已经订阅了该频道的哨兵就会收到这条信息，就知道有一个新的哨兵加入。这些哨兵会与新加入和哨兵建立连接，选主是需要通过这个连接来进行投票。这个关系可以用下面这个图来描述\")]),s._v(\" \"),e(\"p\",[s._v(\":\"),e(\"img\",{attrs:{src:t(571),alt:\"img\"}})]),s._v(\" \"),e(\"h3\",{attrs:{id:\"获取并修改sentinel配置文件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#获取并修改sentinel配置文件\"}},[s._v(\"#\")]),s._v(\" 获取并修改sentinel配置文件\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"通过wget命令获取sentinel的配置文件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#通过wget命令获取sentinel的配置文件\"}},[s._v(\"#\")]),s._v(\" 通过wget命令获取sentinel的配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language- line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"wget http://download.redis.io/redis-stable/sentinel.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"修改配置文件以下几项\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#修改配置文件以下几项\"}},[s._v(\"#\")]),s._v(\" 修改配置文件以下几项\")]),s._v(\" \"),e(\"div\",{staticClass:\"language- line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"vim sentinel.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 让sentinel服务后台运行\")]),s._v(\"\\ndaemonize \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\" \\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 修改日志文件的路径\")]),s._v(\"\\nlogfile \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/var/log/redis/sentinel.log\"')]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 修改监控的主redis服务器\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 最后一个2表示，两台机器判定主被动下线后，就进行failover(故障转移)\")]),s._v(\"\\nsentinel monitor mymaster \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.18\")]),s._v(\".0.2 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 主数据库密码,需要将配置放在sentinel monitor master 127.0.0.1 6379 1下面\")]),s._v(\"\\nsentinel auth-pass mymaster \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"123456789\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"启动容器-2\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#启动容器-2\"}},[s._v(\"#\")]),s._v(\" 启动容器\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"docker run -it --name sentinel -p \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26379\")]),s._v(\":26379 -v /usr/local/docker-redis/sentinel.conf:/usr/local/redis/sentinel.conf -d redis /bin/bash\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"运行哨兵\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#运行哨兵\"}},[s._v(\"#\")]),s._v(\" 运行哨兵\")]),s._v(\" \"),e(\"p\",[s._v(\"进入容器\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"docker \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"exec\")]),s._v(\" -it sentinel \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"bash\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"创建日志目录和文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /usr/local/logs\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"touch\")]),s._v(\" /usr/local/logs/sentinel.log\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\")])]),e(\"p\",[s._v(\"启动sentinel\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"redis-sentinel /usr/local/redis/sentinel.conf\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"查看是否生效\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" /usr/local/logs/sentinel.log\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h2\",{attrs:{id:\"验证故障转移\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#验证故障转移\"}},[s._v(\"#\")]),s._v(\" 验证故障转移\")]),s._v(\" \"),e(\"p\",[s._v(\"为了验证哨兵机制下的自动主从切换，我们将主上的redis进程kill掉。\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"doker \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"top\")]),s._v(\" reedis-master\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"找到redisserver的PID\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"kill\")]),s._v(\" -9 PID\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"稍等几秒钟后，就有另外一台从升级为主机，实验时是第三台机器，也就是redis-3升级为了主，用info命令查询可以看到redis-3服务器的角色变成的master。说明自动主从切换成功。\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"python如何使用redis\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#python如何使用redis\"}},[s._v(\"#\")]),s._v(\" Python如何使用Redis\")]),s._v(\" \"),e(\"p\",[s._v(\"但当我用Python使用的时候出现了两个问题，这里记录一下：\\n1、redis.exceptions.ConnectionError: Error 113 connecting to 172.19.0.3:6379. No route to host.\\n2、redis.exceptions.ConnectionError: Error 99 connecting to 192.168.7.71:6380. Cannot assign requested address.\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_1-安装redis包\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-安装redis包\"}},[s._v(\"#\")]),s._v(\" 1. 安装redis包\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"pip \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" redis\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"_2-实现连接逻辑\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-实现连接逻辑\"}},[s._v(\"#\")]),s._v(\" 2.实现连接逻辑\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"from\")]),s._v(\" redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"sentinel \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" Sentinel\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"from\")]),s._v(\" redis \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" WatchError\\nSENTINEADDRESS \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26380\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26381\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26382\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"def\")]),s._v(\" \\nMYSETINEL \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" Sentinel\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"SENTINEADDRESS\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" socket_timeout\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2000\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"  \"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 尝试连接最长时间单位毫秒, 1000毫\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#有密码可以加上参数password\")]),s._v(\"\\nMASTER \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" MYSETINEL\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"master_for\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'mymaster'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" socket_timeout\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2000\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\nMASTER\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),e(\"span\",{pre:!0,attrs:{class:\"token builtin\"}},[s._v(\"set\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"A\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\nresult\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"MASTER\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"get\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"print\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"result\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\")])]),e(\"p\",[s._v(\"这时候出现错误：\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[s._v(\"redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"exceptions\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"ConnectionError\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Error \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"113\")]),s._v(\" connecting to \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"172.19\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".0\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".3\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\" No route to host\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"h3\",{attrs:{id:\"_3-解决外界访问容器ip过程\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-解决外界访问容器ip过程\"}},[s._v(\"#\")]),s._v(\" 3.解决外界访问容器IP过程\")]),s._v(\" \"),e(\"p\",[s._v(\"首先想到就是容器IP不可达，想到两种解决方案：\")]),s._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",[e(\"code\",[s._v(\"\\t1.获取容器IP转为公网IP后建立连接（单连接正常，频繁连接出现错误）\\n\\n\\t2.搭建了python容器。\\n\")])])]),e(\"h4\",{attrs:{id:\"_1-自我转换-有问题\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-自我转换-有问题\"}},[s._v(\"#\")]),s._v(\" 1.自我转换（有问题）\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#转换的方法\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"def\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"redis_conn\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"s\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"if\")]),s._v(\" s\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"172.19.0.2\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        conn \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"StrictRedis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"\\n            host\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            port\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6380\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pwd\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            decode_responses\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"True\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" conn\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"elif\")]),s._v(\" s\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"172.19.0.3\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        conn \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"StrictRedis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"\\n            host\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            port\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6381\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pwd\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            decode_responses\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"True\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" conn\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"else\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        conn \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"StrictRedis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"\\n            host\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            port\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6382\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pwd\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            decode_responses\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"True\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" conn\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),e(\"br\")])]),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"from\")]),s._v(\" redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"sentinel \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" Sentinel\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"from\")]),s._v(\" apps\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"utils\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"handler \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" redis_conn\\n    sentinel \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" Sentinel\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26380\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26381\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'192.18.0.2'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26382\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n                         \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n                        socket_timeout\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.5\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\nmaster\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"sentinel\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"discover_master\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"mymaster\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\nmaster \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" redis_conn\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"master\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\nresults \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" master\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"get\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"a\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"print\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"results\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\")])]),e(\"p\",[s._v(\"可以正常使用。不过我执行的是定时脚本，需要频繁的写入操作，这时候出现新的问题了。\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[s._v(\"redis\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"exceptions\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"ConnectionError\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Error \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"99\")]),s._v(\" connecting to \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".7\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\".71\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6380\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\" Cannot assign requested address\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"原因就是频繁连接redis。最好的办法就是用哨兵原有的办法连接。\")]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_2-使用python容器\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-使用python容器\"}},[s._v(\"#\")]),s._v(\" 2.使用python容器\")]),s._v(\" \"),e(\"p\",[s._v(\"搭建完容器之后，执行定时脚本，发现依然会出现上述错误，那是因为我把哨兵放到了方法里面，我担心放在方法外面，当故障转移的时候，这个mymaster不能改变，是静态的，当我尝试把\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-python line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-python\"}},[e(\"code\",[s._v(\"master \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" sentinel\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"master_for\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'mymaster'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" socket_timeout\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.5\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" password\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'pwd'\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" db\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"decode_responses\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"True\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\")])]),e(\"p\",[s._v(\"拿出来之后，故意故障转移（kill掉主节点），程序自动切换到正确的节点。\")]),s._v(\" \"),e(\"p\",[s._v(\"结果是可行的。\")]),s._v(\" \"),e(\"p\",[s._v(\"**\"),e(\"u\",[e(\"em\",[s._v(\"声明：部分内容来自网友整理，如有侵权，联系删除\")])]),s._v(\"**i\")])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}